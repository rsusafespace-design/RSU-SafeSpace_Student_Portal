<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Resources - SafeSpace Portal</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    :root {
      --green: #0f7a34;
      --green-light: #e8f5e8;
      --green-dark: #004c27;
      --panel: #ffffff;
      --muted: #6b7280;
      --bg: #f4f6fb;
      --card-shadow: 0 6px 18px rgba(16,24,40,0.06);
      --card-shadow-hover: 0 12px 28px rgba(16,24,40,0.12);
      --radius: 12px;
      --sidebar-width: 250px;
      --collapsed-width: 80px;
      --topbar-height: 64px;
      --accent: #6c5ce7;
      --accent-light: #a29bfe;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    html {
      font-family: 'Segoe UI', system-ui, -apple-system, Roboto, sans-serif;
      font-size: 15px;
    }
    
    body {
      margin: 0;
      background: var(--bg);
      color: #111;
      overflow-x: hidden;
      min-height: 100vh;
    }

    /* ===== Sidebar (admin-like style) ===== */
    .sidebar {
      position:fixed; top:0; left:0;
      width:250px; height:100%;
      background:#f0f3f6; color:#1f2937;
      padding:12px;
      border-right:1px solid rgba(0,0,0,0.06);
      display:flex; flex-direction:column;
      transition:width 0.3s ease, transform 0.3s ease;
      z-index:1200;
    }

    .sidebar .brand {
      display:flex; align-items:center; gap:0.6rem;
      margin-bottom:1rem; padding:8px 4px;
    }

    .sidebar .logo {
      width:40px; height:40px; background:transparent;
      border-radius:8px; display:flex; align-items:center; justify-content:center;
      color:#10b981; font-weight:700; font-size:0.95rem;
      flex-shrink:0; box-shadow:0 1px 2px rgba(0,0,0,0.04);
    }

    .sidebar .brand span { font-weight:700; font-size:1rem; color:#374151; }

    /* collapsed (narrow) sidebar */
    .sidebar.shrink { width:80px; padding:12px 8px; }
    .sidebar.shrink .brand span { display:none; }
    .sidebar.shrink a { text-align:center; font-size:1.1rem; }
    .sidebar.shrink a span { display:none; }

    /* nav items (anchors) styled similar to admin .nav-item */
    .sidebar a {
      display:flex; align-items:center; gap:12px; color:#1f2937;
      text-decoration:none; margin:8px 0; font-size:15px;
      padding:12px 10px; border-radius:8px; background:transparent;
      transition:background 0.18s ease, color 0.18s ease;
    }

  .sidebar a .fa,
  .sidebar a i { width:28px; text-align:center; font-size:18px; color:#1f2937; background:transparent; }

    .sidebar a span { color:inherit; display:inline-block; white-space:nowrap; overflow:hidden; }

    .sidebar a:hover,
    .sidebar a.active {
      background: rgba(15,122,52,0.08); color:#0f7a34; font-weight:600;
    }

    /* Admin-like header & sidebar overrides (no HTML changes) */
    .header-and-sidebar-top {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1000;
      display: flex;
      background-color: #1e8e3e;
      color: white;
      height: 60px;
      transition: left 0.3s ease;
    }

    .sidebar-top {
      width: 250px;
      display: flex;
      align-items: center;
      padding: 10px 20px;
      box-sizing: border-box;
      border-right: 1px solid rgba(255, 255, 255, 0.3);
      height: 60px;
      transition: width 0.3s ease;
    }

    .sidebar {
      position: fixed; /* ensure sidebar spans full height and brand sits at top */
      top: 0;
      left: 0;
      width: 250px;
      height: 100vh;
      background: #f0f3f6;
      border-right: none; /* remove full-height border so brand can appear flush */
      z-index: 1002; /* sit above topbar so brand overlays header area */
      overflow: auto;
    }

    /* Hide the native scrollbar for the sidebar while keeping content scrollable */
    .sidebar {
      scrollbar-width: none; /* Firefox */
      -ms-overflow-style: none; /* IE 10+ */
    }
    .sidebar::-webkit-scrollbar {
      width: 0px;
      height: 0px;
      background: transparent;
    }

    /* vertical divider only below the brand area */
    .sidebar::after {
      content: '';
      position: absolute;
      left: 249px; /* 1px inside right edge */
      top: 60px; /* start after brand/topbar */
      width: 1px;
      height: calc(100vh - 60px);
      background: rgba(0,0,0,0.06);
      z-index: 1001;
    }

    .nav-item, .sidebar a {
      color: #1f2937;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 10px;
      border-radius: 8px;
      background: transparent;
      cursor: pointer;
      font-weight: 400;
      font-size: 15px;
      transition: background 0.2s, color 0.2s;
    }

    .nav-item:hover, .sidebar a:hover {
      background: rgba(15,122,52,0.08) !important;
      color: #0f7a34 !important;
      font-weight: 400 !important;
    }

    .nav-item.active {
      background: rgba(15,122,52,0.12) !important;
      color: #0f7a34 !important;
      font-weight: 600 !important;
    }

    /* adjust content to sit below the fixed topbar and to the right of the sidebar */
    .content { margin-top: 60px; margin-left: 250px; }
    .content.shrink { margin-left: 80px; }

    /* Logo and brand name styling to mirror admin (use inline <img> for crisper control) */
    .sidebar .logo {
      background: transparent;
      width:72px; height:72px; border-radius:6px; box-shadow:none; color:transparent;
      display:flex; align-items:center; justify-content:center; overflow:hidden; padding:0; border:0;
    }

    .sidebar .logo img{
      width:auto; height:64px; max-width:100%; max-height:64px; object-fit:contain; display:block;
      background:transparent; /* preserve transparency */
      image-rendering: -webkit-optimize-contrast;
    }

    /* keep brand/logo aligned with topbar height (60px) */
    .sidebar .brand {
      height: 60px;
      align-items: center;
      padding: 0 12px;
      background: #1e8e3e; /* match topbar background for a seamless look */
      color: white;
      gap: 12px;
    }

    .sidebar .brand span { color: white; font-weight:700; margin-left:4px; }

    /* push nav content below the brand area */
    #nav { padding-top: 12px; margin-top: 60px; }

    /* make the small top-area logo visible in header-like layout */
    .header-and-sidebar-top .sidebar-logo span { color: white; font-weight:700; font-size:1.1rem; }

    /* ===== Topbar (admin-like appearance) ===== */
    .topbar {
      position: fixed;
      top: 0;
      left: 250px; /* sit to the right of the fixed sidebar */
      right: 0;
      height: 60px;
      background-color: #1e8e3e;
      color: white;
      padding: 10px 30px;
      display: flex; justify-content: space-between; align-items: center;
      z-index: 1001;
      transition: left 0.3s ease, margin-left 0.3s ease;
    }
    .topbar.shrink { left: 80px; }

    .topbar-left { display:flex; align-items:center; gap:0.6rem; }
    .hamburger {
      font-size: 1.2rem;
      cursor: pointer;
      padding: 0.3rem;
      border-radius: 4px;
      transition: background 0.2s;
    }
    .hamburger:hover { background: rgba(255,255,255,0.1); }
    .portal-title { display:flex; flex-direction:column; line-height:1.2; }
    .portal-title strong span.safespace { display:none; margin-right:0.3rem; }
    .portal-title small { font-size:0.75rem; opacity:0.9; }

    /* Show SafeSpace text when sidebar is shrunk */
    .topbar.shrink .portal-title strong span.safespace { display: inline; }

    /* Mobile logo styling */
    .mobile-logo {
      display: none;
      width: 44px;
      height: 44px;
      background: transparent; /* remove white circular background */
      border-radius: 6px;
      align-items: center;
      justify-content: center;
      color: #00723f;
      font-weight: bold;
      font-size: 0.8rem;
      margin-right: 0.5rem;
      padding:0;
      overflow:hidden;
    }
    .mobile-logo img{ width:auto; height:34px; object-fit:contain; display:block; background:transparent }

    /* Profile + Notifications */
    .profile { width:38px; height:38px; border-radius:50%; background:#004c27;
      display:flex; align-items:center; justify-content:center; font-weight:bold; cursor:pointer; }
    .notif-wrapper { position:relative; cursor:pointer; font-size:1.3rem; color:white; }
    .notif-badge {
      position:absolute; bottom:0; right:0;
      width:10px; height:10px; background:red;
      border-radius:50%; border:2px solid #00723f;
    }
    .notif-badge.hidden { display:none; }

    .notif-dropdown {
      position:absolute; top:48px; right:0;
      background:white; color:#333;
      width:260px; border-radius:8px;
      box-shadow:0 4px 10px rgba(0,0,0,0.15);
      display:none; flex-direction:column;
      overflow:hidden; z-index:2000;
    }
    .notif-dropdown.active { display:flex; }
    .notif-header { background:#00723f; color:white; padding:0.6rem; font-weight:bold; }
    .notif-list { max-height:220px; overflow-y:auto; }
    .notif-item {
      padding:0.6rem 0.8rem; border-bottom:1px solid #eee;
      font-size:0.9rem; cursor:pointer;
    }
    .notif-item:hover { background:#f1f1f1; }

    /* --- START: NEW ADMIN SYNC STYLES --- */
    .sidebar {
        width: 250px;
        background: #f0f3f6;
        border-right: 1px solid rgba(0,0,0,0.06);
        position: fixed;
        top: 60px; /* Starts below the header */
        left: 0;
        height: calc(100vh - 60px);
        z-index: 999;
        padding: 12px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        transition: width 0.3s ease, transform 0.3s ease;
    }
    
    .sidebar .brand {
        position: fixed;
        top: 0;
        left: 0;
        width: 250px;
        height: 60px;
        background-color: #1e8e3e;
        color: white;
        display: flex;
        align-items: center;
        padding: 10px 20px;
        box-sizing: border-box;
        z-index: 1002;
        border-right: 1px solid rgba(255, 255, 255, 0.3);
        transition: width 0.3s ease;
    }
    
  .sidebar .brand .logo {
    height: 40px;
    width: 40px;
    background: transparent url("safespace.png") center/contain no-repeat;
    color: transparent;
    border-radius: 8px;
  }
    
    .sidebar .brand span {
        font-weight: bold;
        font-size: 1.2rem;
        color: white;
        white-space: nowrap;
        margin-left: 10px;
        transition: opacity 0.3s ease, width 0.3s ease;
    }
    
    .sidebar a {
        margin: 0; /* Nav links start at the top of the sidebar container */
    }
    
    .topbar {
        position: fixed;
        top: 0;
        left: 250px;
        right: 0;
        height: 60px;
        background-color: #1e8e3e;
        color: white;
        padding: 10px 30px;
        z-index: 1000;
        transition: left 0.3s ease;
    }
    
    .content {
        margin-top: 60px;
        margin-left: 250px;
        transition: margin-left 0.3s ease;
    }
    
   /* --- Collapsed State --- */
.sidebar.collapsed {
  width: 80px;
  padding: 12px 8px;
}

.sidebar.collapsed .brand {
  width: 80px;
  justify-content: center;
}

.sidebar.collapsed .brand span {
  opacity: 0;
  pointer-events: none;
  width: 0;
}

.sidebar.collapsed a span {
  display: none;
}
.sidebar.collapsed a {
  justify-content: center;
}

/* ADD THIS NEW CODE RIGHT HERE - Keep emoji icons visible when collapsed */
.sidebar.collapsed a::before {
  content: attr(data-emoji);
  font-size: 1.3rem;
}

.sidebar a::before {
  content: attr(data-emoji);
  margin-right: 8px;
}

.sidebar.collapsed a::before {
  margin-right: 0;
}
/* END OF NEW CSS CODE */
    
    .sidebar.collapsed a span {
        display: none;
    }
    .sidebar.collapsed a {
        justify-content: center;
    }
    
    .topbar.shifted {
        left: 80px;
    }
    
    .content.shifted {
        margin-left: 80px;
    }
    
    /* --- Mobile Overlay & Sidebar --- */
    .sidebar-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 998;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .sidebar-overlay.active {
        display: block;
        opacity: 1;
    }
    
    @media (max-width: 768px) {
        .sidebar {
            top: 0; /* On mobile, the sidebar is full height */
            height: 100vh;
            width: 280px;
            transform: translateX(-100%);
            box-shadow: 4px 0 15px rgba(0, 0, 0, 0.2);
            z-index: 1200; /* Above overlay */
        }
    
        .sidebar.mobile-open {
            transform: translateX(0);
        }
    
        /* Prevent collapsing on mobile view */
        .sidebar.collapsed {
            width: 280px;
            transform: translateX(-100%);
        }
    
        .sidebar .brand {
            width: 280px; /* Brand takes full width of mobile sidebar */
        }
    
        .sidebar .brand.collapsed {
            width: 280px;
            justify-content: flex-start;
        }
    
        .sidebar .brand.collapsed span {
            opacity: 1;
            pointer-events: auto;
            width: auto;
        }
    
        .topbar, .topbar.shifted {
            left: 0;
        }
        .content, .content.shifted {
            margin-left: 0;
        }
    }
    /* --- END: NEW ADMIN SYNC STYLES --- */

    /* Hide hamburger on mobile */
    @media (max-width:768px) {
      .hamburger { display: none; }
    }

    /* ===== Mobile Bottom Nav ===== */
    @media (max-width:768px) {
      .sidebar { 
        display: none !important;
        transform: translateX(-100%);
      }
      .topbar { margin-left:0; }
      .content { margin-left:0; }
      .hamburger { display: none; }
      
      /* Show mobile logo and SafeSpace text */
      .mobile-logo { display: flex; }
      .portal-title strong span.safespace { display: inline; }
      
      .bottom-nav {
        position:fixed; bottom:0; left:0; width:100%;
        background:#004c27; display:flex; justify-content:space-around;
        padding:0.5rem 0; z-index:2000;
      }
      .bottom-nav a {
        flex:1; text-align:center; color:white; text-decoration:none; font-size:0.9rem;
        display:flex; flex-direction:column; align-items:center; justify-content:center;
      }
      .bottom-nav a i { font-size:1.2rem; margin-bottom:0.2rem; }
      .bottom-nav a.active { color:#ffc107; }
    }
    
    /* Hide bottom nav on larger screens */
    .bottom-nav { display: none; }

    @media (max-width: 768px) {
      .bottom-nav { 
        display: flex !important;
        position: fixed;
        bottom: 0; left: 0; right: 0;
        background: #004c27;
        justify-content: space-around;
        padding: 0.4rem 0;
        z-index: 2000;
      }
    }

    /* ===== Misc ===== */
    .hidden {
      display: none !important;
    }

    /* Your existing resources.html styles continue below */
    .page-header {
      margin-bottom: 24px;
      padding-left: 1rem; /* keep title away from the sidebar */
    }

    .page-title {
      font-size: 28px;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 8px;
      animation: slideInLeft 0.6s ease-out;
    }
    .page-subtitle {
      color: var(--text-light);
      font-size: 16px;
      animation: slideInLeft 0.8s ease-out;
    }

    /* slideInLeft animation used by index.html â€” add here so resources matches animation on mobile */
    @keyframes slideInLeft {
      from { opacity: 0; transform: translateX(-30px); }
      to { opacity: 1; transform: translateX(0); }
    }
    .title-block {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    /* Scrollbar styling for lists inside resource/forms cards */
    .resource-list::-webkit-scrollbar,
    .forms-list::-webkit-scrollbar { width: 8px; }
    .resource-list::-webkit-scrollbar-track,
    .forms-list::-webkit-scrollbar-track { background: transparent; }
    .resource-list::-webkit-scrollbar-thumb,
    .forms-list::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.12); border-radius: 8px; }

    @media (max-width: 768px) {
      .resource-list, .forms-list { max-height: 260px; }
    }
    
    /* removed decorative underline below the page title as requested */

    /* Resources Grid */
    .resources-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 25px;
      flex: 1;
    }
    
    .resources-grid > div {
      display: flex;
      flex-direction: column;
      gap: 25px;
    }

    .resources-card {
      background: white;
      border-radius: var(--radius);
      padding: 25px;
      box-shadow: var(--card-shadow);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      border: 1px solid rgba(0,0,0,0.03);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative;
    }
    
    .resources-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: var(--green);
    }
    
    .resources-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--card-shadow-hover);
    }
    
    .resources-card h3 {
      margin-bottom: 20px;
      color: var(--green-dark);
      font-size: 1.3rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .resources-card h3 i {
      color: var(--green);
      background: var(--green-light);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Resource Items */
    .resource-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
      flex: 1 1 auto;
      max-height: 360px; /* keep list scrollable inside the card */
      overflow-y: auto;
      padding-right: 8px;
    }
    
    .resource-item {
      display: flex;
      align-items: flex-start;
      gap: 15px;
      padding: 15px;
      border-radius: 8px;
      background: #f9fafb;
      transition: all 0.3s ease;
      border-left: 3px solid transparent;
      animation: fadeIn 0.5s ease forwards;
      opacity: 0;
      transform: translateY(10px);
    }
    
    .resource-item:nth-child(1) { animation-delay: 0.1s; }
    .resource-item:nth-child(2) { animation-delay: 0.2s; }
    .resource-item:nth-child(3) { animation-delay: 0.3s; }
    .resource-item:nth-child(4) { animation-delay: 0.4s; }
    
    .resource-item:hover {
      background: var(--green-light);
      transform: translateY(-2px);
      border-left-color: var(--green);
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    }
    
    .resource-icon {
      color: #fff;
      font-size: 1.1rem;
      background: var(--green);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 8px rgba(15,122,52,0.3);
      flex-shrink: 0;
    }
    
    .resource-content {
      flex: 1;
    }
    
    .resource-title {
      font-weight: 600;
      color: #333;
      margin-bottom: 5px;
    }
    
    .resource-desc {
      font-size: 0.85rem;
      color: #666;
      margin-bottom: 8px;
    }
    
    .resource-link {
      color: white;
      font-weight: bold;
      cursor: pointer;
      text-decoration: none;
      font-size: 0.9rem;
      padding: 6px 12px;
      border-radius: 6px;
      transition: all 0.2s ease;
      background: var(--green);
      border: none;
      box-shadow: 0 2px 4px rgba(15,122,52,0.2);
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }
    
    .resource-link:hover {
      background: var(--green-dark);
      transform: scale(1.05);
      box-shadow: 0 4px 8px rgba(15,122,52,0.3);
    }

    /* Featured Resource Highlight */
    .featured-resource {
      background: linear-gradient(135deg, #fffbe6, #fff3cd) !important;
      border-left-color: #ffc107 !important;
    }
    
    .featured-badge {
      background: #ffc107;
      color: #333;
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: bold;
      display: inline-block;
      margin-bottom: 8px;
    }

    /* Forms & Documents */
    .forms-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
      max-height: 360px; /* scroll inside forms card */
      overflow-y: auto;
      padding-right: 8px;
    }
    
    .form-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 15px;
      border-radius: 8px;
      background: #f9fafb;
      transition: all 0.3s ease;
      border-left: 3px solid var(--green);
      animation: fadeIn 0.5s ease forwards;
      opacity: 0;
      transform: translateY(10px);
    }
    
    .form-item:nth-child(1) { animation-delay: 0.1s; }
    .form-item:nth-child(2) { animation-delay: 0.2s; }
    .form-item:nth-child(3) { animation-delay: 0.3s; }
    
    .form-item:hover {
      background: var(--green-light);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    }
    
    .form-title {
      font-weight: 600;
      color: #333;
    }
    
    .form-link {
      color: white;
      font-weight: bold;
      cursor: pointer;
      text-decoration: none;
      font-size: 0.9rem;
      padding: 6px 12px;
      border-radius: 6px;
      transition: all 0.2s ease;
      background: var(--green);
      border: none;
      box-shadow: 0 2px 4px rgba(15,122,52,0.2);
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }
    
    .form-link:hover {
      background: var(--green-dark);
      transform: scale(1.05);
      box-shadow: 0 4px 8px rgba(15,122,52,0.3);
    }

    /* Animations */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(15, 122, 52, 0.4);
      }
      70% {
        box-shadow: 0 0 0 10px rgba(15, 122, 52, 0);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(15, 122, 52, 0);
      }
    }

    .pulse {
      animation: pulse 2s infinite;
    }

    /* Mobile adjustments */
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
      }
      
      .sidebar.mobile-open {
        transform: translateX(0);
      }
      
      .topbar {
        left: 0;
      }
      
      .content {
        margin-left: 0;
        padding: 20px 15px 80px 15px;
        margin-top: var(--topbar-height);
      }
      
      .mobile-logo {
        display: flex;
      }
      
      .resources-grid {
        grid-template-columns: 1fr;
        gap: 20px;
      }
      
      .hamburger {
        display: block;
      }
      
      .resource-item, .form-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }
      
      .resource-link, .form-link {
        align-self: flex-end;
      }
    }

    /* Bottom Nav (mobile only) */
    .bottom-nav {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #fff;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
      z-index: 2000;
      padding: 10px 0;
    }
    
    @media (max-width: 768px) {
      .bottom-nav {
        display: flex;
        justify-content: space-around;
      }
    }
    
    .bottom-nav a {
      flex: 1;
      text-align: center;
      color: var(--muted);
      text-decoration: none;
      font-size: 0.8rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 8px 0;
      transition: all 0.2s ease;
    }
    
    .bottom-nav a i {
      font-size: 1.2rem;
      margin-bottom: 5px;
      transition: transform 0.2s ease;
    }
    
    .bottom-nav a.active {
      color: var(--green);
    }
    
    .bottom-nav a:hover i {
      transform: translateY(-2px);
    }

    /* Modal styling */
    .modal-overlay {
      display: flex;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.5);
      z-index: 3000;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.3s ease;
      backdrop-filter: blur(5px);
    }
    
    .modal-overlay.hidden {
      display: none !important;
    }
    
    .modal-box {
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
      padding: 25px;
      max-width: 400px;
      width: 90%;
      text-align: center;
      position: relative;
      transform: scale(0.9);
      animation: modalAppear 0.3s ease forwards;
    }
    
    @keyframes modalAppear {
      to {
        transform: scale(1);
      }
    }
    
    .modal-close {
      position: absolute;
      top: 15px;
      right: 20px;
      font-size: 1.5rem;
      color: #888;
      cursor: pointer;
      transition: color 0.2s ease;
    }
    
    .modal-close:hover {
      color: #333;
    }
    
    .modal-content {
      margin: 20px 0;
      font-size: 1.1rem;
      line-height: 1.5;
    }
    
    .modal-ok {
      background: var(--green);
      color: white;
      border: none;
      border-radius: 6px;
      padding: 10px 25px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 2px 4px rgba(15,122,52,0.2);
    }
    
    .modal-ok:hover {
      background: var(--green-dark);
      transform: scale(1.05);
    }

    /* Resource Viewer Modal */
    .resource-modal {
      max-width: 90vw;
      max-height: 90vh;
      width: 90vw;
      height: 90vh;
      padding: 0;
      display: flex;
      flex-direction: column;
    }

    .resource-modal .modal-header {
      padding: 20px 25px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: white;
      border-radius: 12px 12px 0 0;
    }

    .resource-modal .modal-header h3 {
      margin: 0;
      font-size: 1.2rem;
      font-weight: 600;
      color: #111;
    }

    .resource-modal .modal-body {
      flex: 1;
      padding: 0;
      overflow: hidden;
      background: #f8f9fa;
    }

    .resource-modal .modal-close {
      position: static;
      font-size: 1.8rem;
      color: #666;
      cursor: pointer;
      transition: color 0.2s ease;
      background: none;
      border: none;
      padding: 5px;
      border-radius: 4px;
    }

    .resource-modal .modal-close:hover {
      color: #333;
      background: #f3f4f6;
    }

    #resourceViewerContent {
      width: 100%;
      height: 100%;
      background: white;
    }

    #resourceViewerContent iframe {
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 0 0 12px 12px;
    }

    #resourceViewerContent video {
      width: 100%;
      height: 100%;
      object-fit: contain;
      background: black;
    }

    #resourceViewerContent img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      display: block;
      margin: 0 auto;
    }

    /* Mobile adjustments for resource modal */
    @media (max-width: 768px) {
      .resource-modal {
        width: 95vw;
        height: 95vh;
      }

      .resource-modal .modal-header {
        padding: 15px 20px;
      }

      .resource-modal .modal-header h3 {
        font-size: 1.1rem;
      }
    }

    /* Footer */
    .footer {
      text-align: center;
      padding: 20px;
      color: var(--muted);
      font-size: 0.9rem;
      margin-top: auto;
    }
  </style>
  <style id="assessments-mobile-overrides">
    /* Mobile overrides copied from assessments.html to ensure exact parity */
    /* Hide hamburger on small screens */
    @media (max-width: 768px) {
      .hamburger { display: none !important; }
    }

    /* Bottom Nav (mobile only) - match assessments.html exactly */
    .bottom-nav {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #1e8e3e; /* match topbar color from assessments */
      justify-content: space-around;
      padding: 0.6rem 0;
      height: 64px;
      z-index: 1000;
      box-shadow: 0 -6px 20px rgba(0, 0, 0, 0.18);
    }

    @media (max-width: 768px) {
      .bottom-nav {
        display: flex !important;
        height: 64px !important;
        padding: 8px 0 !important;
      }
    }

    .bottom-nav a {
      flex: 1;
      text-align: center;
      color: #fff;
      text-decoration: none;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      opacity: 1;
      transition: all 0.3s ease;
      padding: 10px 6px !important;
      border-radius: 8px;
    }

    .bottom-nav a.active {
      color: #fff;
      background: rgba(255,255,255,0.06);
      transform: translateY(-4px);
      box-shadow: 0 6px 14px rgba(0,0,0,0.12);
    }

    .bottom-nav a:hover:not(.active) { background: rgba(255,255,255,0.03); }

    .bottom-nav a i { font-size: 28px !important; line-height: 1; transition: all 0.3s ease; color: #ffffff; text-shadow: 0 1px 0 rgba(0,0,0,0.15); }

    .bottom-nav a:hover i { transform: scale(1.05); }

    /* Hide bottom-nav text labels so only emoji/icons are shown */
    .bottom-nav a .bn-label { display: none !important; }
    .bottom-nav a .bn-emoji { font-size: 28px !important; line-height: 1; display: inline-block; }

    /* Topbar mobile adjustments to match assessments.html */
    @media (max-width: 768px) {
      .topbar { left: 0 !important; right: 0 !important; padding: 8px 12px !important; height: 64px; }
      .mobile-logo { display: flex !important; }
      .portal-title { gap: 0; }
      .portal-title small { display: inline-block; font-size:0.75rem; color: rgba(255,255,255,0.9); }
    }

    /* Make mobile logo image size and brand spacing match assessments exactly */
    @media (max-width: 768px) {
      .mobile-logo { width:48px; height:48px; display:flex; align-items:center; justify-content:center; }
      .mobile-logo img { height:40px !important; width:auto !important; object-fit:contain !important; }
      .sidebar .brand { height: 80px; align-items: center; padding: 12px 20px; }
      .sidebar .brand .logo { width:80px; height:80px; border-radius:8px; }
      .sidebar .brand .logo img { height:40px !important; width:auto !important; }
      /* Ensure sidebar is hidden on mobile (assessments shows bottom nav instead) */
      .sidebar { display: none !important; transform: translateX(-100%) !important; }
      .content { margin-left: 0 !important; padding: 20px 15px 4rem 15px !important; margin-top: 60px !important; }
    }
  </style>
  <style id="appointments-copy">
    :root {
      --primary: #0f7a34;
      --primary-light: #e8f5e9;
      --primary-dark: #0a5a26;
      --topbar-bg: #1e8e3e;
      --secondary: #4361ee;
      --accent: #7209b7;
      --text: #2d3748;
      --text-light: #718096;
      --bg: #f8fafc;
      --card-bg: #ffffff;
      --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      --card-shadow-hover: 0 8px 30px rgba(0, 0, 0, 0.12);
      --radius: 16px;
      --radius-sm: 8px;
      --sidebar-width: 280px;
      --collapsed-width: 80px;
      --topbar-height: 70px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      font-size: 16px;
      color: var(--text);
    }

    body {
      background: var(--bg);
      overflow-x: hidden;
    }

    /* ===== Sidebar (admin-like style) ===== */
    .sidebar {
      position:fixed; top:0; left:0;
      width:250px; height:100%;
      background:#f0f3f6; color:#1f2937;
      padding:12px;
      border-right:1px solid rgba(0,0,0,0.06);
      display:flex; flex-direction:column;
      transition:width 0.3s ease, transform 0.3s ease;
      z-index:1200;
    }

    .sidebar .brand {
      display:flex; align-items:center; gap:0.6rem;
      margin-bottom:1rem; padding:8px 4px;
    }

    .sidebar .logo {
      width:40px; height:40px; background:transparent;
      border-radius:8px; display:flex; align-items:center; justify-content:center;
      color:#10b981; font-weight:700; font-size:0.95rem;
      flex-shrink:0; box-shadow:0 1px 2px rgba(0,0,0,0.04);
    }

    .sidebar .brand span { font-weight:700; font-size:1rem; color:#374151; }

    /* collapsed (narrow) sidebar */
    .sidebar.shrink { width:80px; padding:12px 8px; }
    .sidebar.shrink .brand span { display:none; }
    .sidebar.shrink a { text-align:center; font-size:1.1rem; }
    .sidebar.shrink a span { display:none; }

    /* nav items (anchors) styled similar to admin .nav-item */
    .sidebar a {
      display:flex; align-items:center; gap:12px; color:#1f2937;
      text-decoration:none; margin:8px 0; font-size:15px;
      padding:12px 10px; border-radius:8px; background:transparent;
      transition:background 0.18s ease, color 0.18s ease;
    }

  .sidebar a .fa,
  .sidebar a i { width:28px; text-align:center; font-size:18px; color:#1f2937; background:transparent; }

    .sidebar a span { color:inherit; display:inline-block; white-space:nowrap; overflow:hidden; }

    .sidebar a:hover,
    .sidebar a.active {
      background: rgba(15,122,52,0.08); color:#0f7a34; font-weight:600;
    }

    /* Admin-like header & sidebar overrides (no HTML changes) */
    .header-and-sidebar-top {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1000;
      display: flex;
      background-color: #1e8e3e;
      color: white;
      height: 60px;
      transition: left 0.3s ease;
    }

    .sidebar-top {
      width: 250px;
      display: flex;
      align-items: center;
      padding: 10px 20px;
      box-sizing: border-box;
      border-right: 1px solid rgba(255, 255, 255, 0.3);
      height: 60px;
      transition: width 0.3s ease;
    }

    .sidebar {
      position: fixed; /* ensure sidebar spans full height and brand sits at top */
      top: 0;
      left: 0;
      width: 250px;
      height: 100vh;
      background: #f0f3f6;
      border-right: none; /* remove full-height border so brand can appear flush */
      z-index: 1002; /* sit above topbar so brand overlays header area */
      overflow: auto;
    }

    /* Hide the native scrollbar for the sidebar while keeping content scrollable */
    .sidebar {
      scrollbar-width: none; /* Firefox */
      -ms-overflow-style: none; /* IE 10+ */
    }
    .sidebar::-webkit-scrollbar {
      width: 0px;
      height: 0px;
      background: transparent;
    }

    /* vertical divider only below the brand area */
    .sidebar::after {
      content: '';
      position: absolute;
      left: 249px; /* 1px inside right edge */
      top: 60px; /* start after brand/topbar */
      width: 1px;
      height: calc(100vh - 60px);
      background: rgba(0,0,0,0.06);
      z-index: 1001;
    }

    .nav-item, .sidebar a {
      color: #1f2937;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 10px;
      border-radius: 8px;
      background: transparent;
      cursor: pointer;
      font-weight: 400;
      font-size: 15px;
      transition: background 0.2s, color 0.2s;
    }

    .nav-item:hover, .sidebar a:hover {
      background: rgba(15,122,52,0.08) !important;
      color: #0f7a34 !important;
      font-weight: 400 !important;
    }

    .nav-item.active {
      background: rgba(15,122,52,0.12) !important;
      color: #0f7a34 !important;
      font-weight: 600 !important;
    }

    /* adjust content to sit below the fixed topbar and to the right of the sidebar */
    .content { margin-top: 60px; margin-left: 250px; }
    .content.shrink { margin-left: 80px; }

    /* Logo and brand name styling to mirror admin */
    .sidebar .logo {
      background: transparent;
      width:72px; height:72px; border-radius:6px; box-shadow:none; color:transparent;
      display:flex; align-items:center; justify-content:center; overflow:hidden; padding:0; border:0;
    }
    .sidebar .logo img{
      width:auto; height:64px; max-width:100%; max-height:64px; object-fit:contain; display:block;
      background:transparent; /* in case image has transparency preserve it */
      image-rendering: -webkit-optimize-contrast;
    }

    /* keep brand/logo aligned with topbar height (60px) */
    .sidebar .brand {
      height: 60px;
      align-items: center;
      padding: 0 12px;
      background: #1e8e3e; /* match topbar background for a seamless look */
      color: white;
      gap: 12px;
    }

    .sidebar .brand span { color: white; font-weight:700; margin-left:4px; }

    /* push nav content below the brand area */
    #nav { padding-top: 12px; margin-top: 60px; }

    /* make the small top-area logo visible in header-like layout */
    .header-and-sidebar-top .sidebar-logo span { color: white; font-weight:700; font-size:1.1rem; }

    /* ===== Topbar (admin-like appearance) ===== */
    .topbar {
      position: fixed;
      top: 0;
      left: 250px; /* sit to the right of the fixed sidebar */
      right: 0;
      height: 60px;
      background-color: var(--topbar-bg);
      color: white;
      padding: 10px 30px;
      display: flex; justify-content: space-between; align-items: center;
      z-index: 1001;
      transition: left 0.3s ease, margin-left 0.3s ease;
    }
    .topbar.shrink { left: 80px; }

    .topbar-left { display:flex; align-items:center; gap:0.6rem; }
    .hamburger {
      font-size: 1.2rem;
      cursor: pointer;
      padding: 0.3rem;
      border-radius: 4px;
      transition: background 0.2s;
    }
    .hamburger:hover { background: rgba(255,255,255,0.1); }
  .portal-title { display:flex; flex-direction:column; line-height:1.2; }
  .portal-title strong span.safespace { display:inline; margin-right:0.3rem; }
    .portal-title small { font-size:0.75rem; opacity:0.9; }

    /* Show SafeSpace text when sidebar is shrunk */
    .topbar.shrink .portal-title strong span.safespace { display: inline; }

    /* Mobile logo styling */
    .mobile-logo {
      display: none;
      width: 44px;
      height: 44px;
      background: transparent; /* remove white circular background */
      border-radius: 6px;
      align-items: center;
      justify-content: center;
      color: #00723f;
      font-weight: bold;
      font-size: 0.8rem;
      margin-right: 0.5rem;
      padding:0;
      overflow:hidden;
    }
  .mobile-logo img{ width:auto; height:34px; object-fit:contain; display:block; background:transparent }

    /* Profile + Notifications */
    .profile { width:38px; height:38px; border-radius:50%; background:#004c27;
      display:flex; align-items:center; justify-content:center; font-weight:bold; cursor:pointer; }
    .notif-wrapper { position:relative; cursor:pointer; font-size:1.3rem; color:white; }
    .notif-badge {
      position:absolute; bottom:0; right:0;
      width:10px; height:10px; background:red;
      border-radius:50%; border:2px solid #00723f;
    }
    .notif-badge.hidden { display:none; }

    .notif-dropdown {
      position:absolute; top:48px; right:0;
      background:white; color:#333;
      width:260px; border-radius:8px;
      box-shadow:0 4px 10px rgba(0,0,0,0.15);
      display:none; flex-direction:column;
      overflow:hidden; z-index:2000;
    }
    .notif-dropdown.active { display:flex; }
    .notif-header { background:#00723f; color:white; padding:0.6rem; font-weight:bold; }
    .notif-list { max-height:220px; overflow-y:auto; }
    .notif-item {
      padding:0.6rem 0.8rem; border-bottom:1px solid #eee;
      font-size:0.9rem; cursor:pointer;
    }
    .notif-item:hover { background:#f1f1f1; }

    /* --- START: NEW ADMIN SYNC STYLES --- */
    .sidebar {
        width: 250px;
        background: #f0f3f6;
        border-right: 1px solid rgba(0,0,0,0.06);
        position: fixed;
        top: 60px; /* Starts below the header */
        left: 0;
        height: calc(100vh - 60px);
        z-index: 999;
        padding: 12px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        transition: width 0.3s ease, transform 0.3s ease;
    }
    
    .sidebar .brand {
        position: fixed;
        top: 0;
        left: 0;
        width: 250px;
        height: 60px;
        background-color: #1e8e3e;
        color: white;
        display: flex;
        align-items: center;
        padding: 10px 20px;
        box-sizing: border-box;
        z-index: 1002;
        border-right: 1px solid rgba(255, 255, 255, 0.3);
        transition: width 0.3s ease;
    }
    
  .sidebar .brand .logo {
    height: 40px;
    width: 40px;
    background: transparent url("safespace.png") center/contain no-repeat;
    color: transparent;
    border-radius: 8px;
  }
    
    .sidebar .brand span {
        font-weight: bold;
        font-size: 1.2rem;
        color: white;
        white-space: nowrap;
        margin-left: 10px;
        transition: opacity 0.3s ease, width 0.3s ease;
    }
    
    .sidebar a {
        margin: 0; /* Nav links start at the top of the sidebar container */
    }
    
    .topbar {
        position: fixed;
        top: 0;
        left: 250px;
        right: 0;
        height: 60px;
        background-color: #1e8e3e;
        color: white;
        padding: 10px 30px;
        z-index: 1000;
        transition: left 0.3s ease;
    }
    
    .content {
        margin-top: 60px;
        margin-left: 250px;
        transition: margin-left 0.3s ease;
    }
    
   /* --- Collapsed State --- */
.sidebar.collapsed {
  width: 80px;
  padding: 12px 8px;
}

.sidebar.collapsed .brand {
  width: 80px;
  justify-content: center;
}

.sidebar.collapsed .brand span {
  opacity: 0;
  pointer-events: none;
  width: 0;
}

.sidebar.collapsed a span {
  display: none;
}
.sidebar.collapsed a {
  justify-content: center;
}

/* ADD THIS NEW CODE RIGHT HERE - Keep emoji icons visible when collapsed */
.sidebar.collapsed a::before {
  content: attr(data-emoji);
  font-size: 1.3rem;
}

.sidebar a::before {
  content: attr(data-emoji);
  margin-right: 8px;
}

.sidebar.collapsed a::before {
  margin-right: 0;
}
/* END OF NEW CSS CODE */
    
    .sidebar.collapsed a span {
        display: none;
    }
    .sidebar.collapsed a {
        justify-content: center;
    }
    
    .topbar.shifted {
        left: 80px;
    }
    
    .content.shifted {
        margin-left: 80px;
    }
    
    /* --- Mobile Overlay & Sidebar --- */
    .sidebar-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 998;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .sidebar-overlay.active {
        display: block;
        opacity: 1;
    }
    
    @media (max-width: 768px) {
        .sidebar {
            top: 0; /* On mobile, the sidebar is full height */
            height: 100vh;
            width: 280px;
            transform: translateX(-100%);
            box-shadow: 4px 0 15px rgba(0, 0, 0, 0.2);
            z-index: 1200; /* Above overlay */
        }
    
        .sidebar.mobile-open {
            transform: translateX(0);
        }
    
        /* Prevent collapsing on mobile view */
        .sidebar.collapsed {
            width: 280px;
            transform: translateX(-100%);
        }
    
        .sidebar .brand {
            width: 280px; /* Brand takes full width of mobile sidebar */
        }
    
        .sidebar .brand.collapsed {
            width: 280px;
            justify-content: flex-start;
        }
    
        .sidebar .brand.collapsed span {
            opacity: 1;
            pointer-events: auto;
            width: auto;
        }
    
        .topbar, .topbar.shifted {
            left: 0;
        }
        .content, .content.shifted {
            margin-left: 0;
        }
    }
    /* --- END: NEW ADMIN SYNC STYLES --- */
  </style>
</head>
<body>
  <!-- Sidebar (copied from assessments.html for exact layout/behaviour) -->
  <div class="sidebar" id="sidebar">
    <div class="brand">
      <div class="logo"><img src="safespace.png" alt="SafeSpace logo"></div>
      <span>SafeSpace</span>
    </div>
    <a href="index.html" data-emoji="ðŸ“…"><span>Appointments</span></a>
    <a href="history.html" data-emoji="ðŸ“‹"><span>History</span></a>
    <a href="assessments.html" data-emoji="ðŸ“"><span>Assessments</span></a>
    <a href="resources.html" class="active" data-emoji="ðŸ“š"><span>Resources</span></a>
    <a href="messages.html" data-emoji="ðŸ’¬"><span>Messages</span></a>
    <a href="settings.html" data-emoji="âš™ï¸"><span>Settings</span></a>
  </div>

  <!-- Topbar (copied from assessments.html for exact layout/behaviour) -->
  <div class="topbar" id="topbar">
    <div class="topbar-left">
      <div class="hamburger">
        <i class="fas fa-bars"></i>
      </div>
      <div class="mobile-logo"><img src="safespace.png" alt="SafeSpace"></div>
      <div class="portal-title">
        <strong><span class="safespace">RSU SafeSpace: </span>Student Portal</strong>
        <small></small>
      </div>
    </div>
    <div style="display:flex; align-items:center; gap:1rem; position:relative;">
      <div class="notif-wrapper" onclick="toggleNotif()">
        <span class="icon-btn">ðŸ””</span>
        <div class="notif-badge" style="position:absolute;right:4px;bottom:8px;width:8px;height:8px;background:#ef4444;border-radius:50%;border:2px solid var(--green)"></div>
      </div>
      <div id="notifDropdown" class="notif-dropdown">
        <div class="notif-header">Notifications</div>
        <div class="notif-list">
          <div class="notif-item" onclick="goToSection('appointments')">ðŸ”” New counseling slots available</div>
          <div class="notif-item" onclick="goToSection('messages')">ðŸ“© You have a new message from your counselor</div>
          <div class="notif-item" onclick="goToSection('assessments')">âš  Reminder: Complete your assessment</div>
        </div>
      </div>
      <div class="profile" onclick="window.location.href='profile.html'"></div>
    </div>
  </div>

  <!-- Content -->
  <div class="content" id="content">
    <div class="page-header">
      <div class="title-block">
        <h1 class="page-title">Resources</h1>
        <p class="page-subtitle">Helpful guides, forms, and support materials for you.</p>
      </div>
    </div>
    
    <div class="resources-grid">
      <!-- Featured Resources Card -->
      <div>
        <div class="resources-card">
          <h3><i class="fas fa-star"></i> Featured Resources</h3>
          <div id="featuredList" class="resource-list">
            <!-- Featured resources will be injected here from Firebase (node: 'files'). -->
          </div>
        </div>
      </div>
      
      <!-- Forms & Documents Card -->
      <div>
        <div class="resources-card">
          <h3><i class="fas fa-file-contract"></i> Forms & Documents</h3>
          <div id="formsList" class="forms-list">
            <!-- Forms & documents will be injected here from Firebase (node: 'files'). -->
          </div>
        </div>
        
        <!-- Additional Resources Card -->
        <div class="resources-card">
          <h3><i class="fas fa-lightbulb"></i> Quick Tips</h3>
          <div id="otherList" class="resource-list">
            <!-- Other resources (tips, videos, audio) will be injected here from Firebase (node: 'files'). -->
          </div>
        </div>
      </div>
    </div>
    
    <div class="footer">
      <p>Â© 2025 RSU SafeSpace | Student Support Management System</p>
    </div>
  </div>

  <!-- Bottom Navigation from index.html -->
  <div class="bottom-nav">
    <a href="index.html"><span class="bn-emoji">ðŸ“…</span><span class="bn-label">Appointments</span></a>
    <a href="history.html"><span class="bn-emoji">ðŸ“‹</span><span class="bn-label">History</span></a>
    <a href="assessments.html"><span class="bn-emoji">ðŸ“</span><span class="bn-label">Assessments</span></a>
    <a href="resources.html" class="active"><span class="bn-emoji">ðŸ“š</span><span class="bn-label">Resources</span></a>
    <a href="messages.html"><span class="bn-emoji">ðŸ’¬</span><span class="bn-label">Messages</span></a>
    <a href="settings.html"><span class="bn-emoji">âš™ï¸</span><span class="bn-label">Settings</span></a>
  </div>

  <!-- Modal Overlay -->
  <div id="modalOverlay" class="modal-overlay" style="display: none;">
    <div id="modalBox" class="modal-box">
      <span id="modalClose" class="modal-close">&times;</span>
      <div id="modalContent" class="modal-content"></div>
      <button id="modalOk" class="modal-ok">OK</button>
    </div>
  </div>

  <!-- Add Firebase SDKs before your main script -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
  <script src="firebase_config.js"></script>

  <script>
    // --- START: NEW ADMIN SYNC SIDEBAR SCRIPT ---
    const menuIcon = document.querySelector('.hamburger');
    const sidebar = document.getElementById('sidebar');
    const mainContent = document.getElementById('content');
    const sidebarTop = document.querySelector('.sidebar .brand');
    const topbar = document.getElementById('topbar');
    
    // Create overlay for mobile
    const overlay = document.createElement('div');
    overlay.className = 'sidebar-overlay';
    document.body.appendChild(overlay);
    
    // Mobile detection
    function isMobile() {
        return window.innerWidth <= 768;
    }
    
    // Toggle sidebar with mobile responsiveness
    if (menuIcon) {
        menuIcon.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            
            if (isMobile()) {
                // Mobile behavior - overlay sidebar
                const isOpen = sidebar.classList.toggle('mobile-open');
                overlay.classList.toggle('active', isOpen);
                document.body.style.overflow = isOpen ? 'hidden' : '';
            } else {
                // Desktop behavior - collapse sidebar
                const isCollapsed = sidebar.classList.toggle('collapsed');
                mainContent.classList.toggle('shifted', isCollapsed);
                sidebarTop.classList.toggle('collapsed', isCollapsed);
                topbar.classList.toggle('shifted', isCollapsed);
            }
        });
    }
    
    // Close mobile sidebar when clicking overlay
    overlay.addEventListener('click', () => {
        sidebar.classList.remove('mobile-open');
        overlay.classList.remove('active');
        document.body.style.overflow = '';
    });
    
    // Handle window resize
    window.addEventListener('resize', () => {
        if (!isMobile()) {
            // Reset mobile states when switching to desktop
            sidebar.classList.remove('mobile-open');
            overlay.classList.remove('active');
            document.body.style.overflow = '';
            // Ensure desktop state is consistent
            const isCollapsed = sidebar.classList.contains('collapsed');
            mainContent.classList.toggle('shifted', isCollapsed);
            sidebarTop.classList.toggle('collapsed', isCollapsed);
            topbar.classList.toggle('shifted', isCollapsed);
        } else {
            // Reset desktop states when switching to mobile
            sidebar.classList.remove('collapsed');
            mainContent.classList.remove('shifted');
            sidebarTop.classList.remove('collapsed');
            topbar.classList.remove('shifted');
        }
    });
    
    // Close mobile sidebar when clicking a menu item
    document.querySelectorAll('.sidebar a').forEach(link => {
        link.addEventListener('click', () => {
            if (isMobile()) {
                sidebar.classList.remove('mobile-open');
                overlay.classList.remove('active');
                document.body.style.overflow = '';
            }
        });
    });
    // --- END: NEW ADMIN SYNC SIDEBAR SCRIPT ---

    // Notification toggle
    function toggleNotif() {
      const dropdown = document.getElementById("notifDropdown");
      const badge = document.querySelector(".notif-badge");
      dropdown.classList.toggle("active");
      if (dropdown.classList.contains("active")) { badge.classList.add("hidden"); }
    }

    // Close notification dropdown when clicking outside
    document.addEventListener("click", function(e){
      const dropdown = document.getElementById("notifDropdown");
      const notifBtn = document.querySelector(".notif-wrapper");
      if (notifBtn && dropdown && !notifBtn.contains(e.target) && !dropdown.contains(e.target)) {
        dropdown.classList.remove("active");
      }
    });

    // Navigation
    function goToSection(sectionId) {
      if (sectionId === 'appointments') {
        window.location.href = 'index.html';
      } else if (sectionId === 'history') {
        window.location.href = 'history.html';
      } else if (sectionId === 'assessments') {
        window.location.href = 'assessments.html';
      } else if (sectionId === 'resources') {
        window.location.href = 'resources.html';
      } else if (sectionId === 'messages') {
        window.location.href = 'messages.html';
      } else {
        alert("Navigation to " + sectionId);
      }
      document.getElementById("notifDropdown").classList.remove("active");
    }

    // Modal functions
    function showModal(message) {
      const modalOverlay = document.getElementById('modalOverlay');
      const modalContent = document.getElementById('modalContent');
      modalContent.textContent = message;
      modalOverlay.classList.remove('hidden');
    }

    function closeModal() {
      const modalOverlay = document.getElementById('modalOverlay');
      modalOverlay.classList.add('hidden');
    }

    // Resource functions
    function openResource(name) {
      showModal(`Opening resource: "${name}". This feature will be available soon.`);
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      // Set up event listeners
      document.getElementById('modalClose').addEventListener('click', closeModal);
      document.getElementById('modalOk').addEventListener('click', closeModal);
      
      // Close modal when clicking outside
      document.getElementById('modalOverlay').addEventListener('click', function(e) {
        if (e.target === this) closeModal();
      });
      
      // Populate topbar/profile when auth state changes (or if already signed in)
      function updateTopbarWithStudentData(user) {
        const dbRef = window.db || (window.firebase ? firebase.database() : null);
        if (!dbRef || !user) return;
        dbRef.ref('students').orderByChild('uid').equalTo(user.uid).once('value').then(function(snapshot){
          if (snapshot.exists()){
            snapshot.forEach(function(child){
              const data = child.val() || {};
              const topbarStudentId = document.querySelector('.portal-title small');
              if (topbarStudentId) topbarStudentId.textContent = 'ID: ' + (data.student_id || data.student_id_number || 'N/A');

              const topbarProfile = document.querySelector('.profile');
              if (topbarProfile) {
                if (data.photo_url) {
                  topbarProfile.innerHTML = `<img src="${data.photo_url}" alt="Profile Photo" style="width:38px;height:38px;border-radius:50%;object-fit:cover;">`;
                } else {
                  const initials = ((data.first_name||'').charAt(0) + (data.last_name||'').charAt(0)).toUpperCase() || (data.username||'U').charAt(0).toUpperCase();
                  topbarProfile.textContent = initials;
                }
              }
            });
          }
        }).catch(function(err){ console.warn('Failed to load student for topbar', err); });
      }

      // Listen for auth changes
      try {
        const authInstance = window.auth || (window.firebase && firebase.auth ? firebase.auth() : null);
        if (authInstance && authInstance.onAuthStateChanged) {
          authInstance.onAuthStateChanged(function(user){
            if (user) {
              updateTopbarWithStudentData(user);
            } else {
              // Clear topbar when signed out
              const topbarStudentId = document.querySelector('.portal-title small'); if (topbarStudentId) topbarStudentId.textContent = '';
              const topbarProfile = document.querySelector('.profile'); if (topbarProfile) topbarProfile.textContent = '';
            }
          });
          // If already signed in, update immediately
          if (authInstance.currentUser) updateTopbarWithStudentData(authInstance.currentUser);
        } else {
          // Fallback: try firebase.auth().currentUser
          const fbAuth = (window.firebase && firebase.auth) ? firebase.auth() : null;
          if (fbAuth && fbAuth.currentUser) updateTopbarWithStudentData(fbAuth.currentUser);
        }
      } catch (e) { console.warn('Topbar auth/update failed', e); }
    });
</script>

  <!-- Student resources loader: fetch files from Firebase Realtime Database and render -->
  <script>
    (function(){
      // Use shared firebase_config.js provided globals
      window.auth = window.auth || (window.firebase ? firebase.auth() : null);
      const db = window.db || (window.firebase ? firebase.database() : null);
      const storage = window.storage || (window.firebase && firebase.storage ? firebase.storage() : null);
      if (!db) return console.warn('Firebase Realtime Database not available');

      const filesRef = db.ref('files');
      const featuredList = document.getElementById('featuredList');
      const formsList = document.getElementById('formsList');
      const otherList = document.getElementById('otherList');

      function formatSize(bytes){
        if (!bytes && bytes !== 0) return '-';
        const kb = 1024;
        if (bytes < kb) return bytes + ' B';
        const units = ['KB','MB','GB','TB'];
        let i = -1; do { bytes = bytes / kb; i++; } while (bytes >= kb && i < units.length-1);
        return bytes.toFixed( (i<1)?0:1 ) + ' ' + units[i];
      }

      // Download helper for base64 payloads (only invoked on user action)
      function downloadBase64(filename, mimeType, base64Data){
        try {
          const dataUrl = 'data:' + (mimeType || 'application/octet-stream') + ';base64,' + (base64Data || '');
          // Convert to blob and download
          fetch(dataUrl).then(res => res.blob()).then(blob => {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename || 'file';
            document.body.appendChild(a);
            a.click();
            a.remove();
            URL.revokeObjectURL(url);
          }).catch(err => {
            console.error('Download failed', err);
            alert('Download failed. Try opening the file in a new tab.');
          });
        } catch (e) { console.error(e); alert('Download failed.'); }
      }

      // Storage URL cache to avoid repeated getDownloadURL calls
      const _storageUrlCache = {};
      function getYouTubeVideoId(url) {
        const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
        const match = url.match(regExp);
        return (match && match[2].length == 11) ? match[2] : null;
      }
      function getStorageUrl(storagePath){
        return new Promise((resolve, reject) => {
          if (!storagePath) return reject(new Error('No storagePath'));
          if (_storageUrlCache[storagePath]) return resolve(_storageUrlCache[storagePath]);
          try {
            const storageRef = storage ? storage.ref(storagePath) : (window.firebase && firebase.storage ? firebase.storage().ref(storagePath) : null);
            storageRef.getDownloadURL().then(url => { _storageUrlCache[storagePath] = url; resolve(url); }).catch(reject);
          } catch (e) { reject(e); }
        });
      }

      function createResourceNode(file){
        const item = document.createElement('div');
        item.className = 'resource-item';
        if (file.featured || (file.category||'').toLowerCase().includes('featured')) item.classList.add('featured-resource');

        const icon = document.createElement('span');
        icon.className = 'resource-icon';
        // choose icon by mime or extension
        const mime = (file.mimeType||'').toLowerCase();
        let iconHtml = '<i class="fas fa-file"></i>';
        if (mime.includes('pdf')) iconHtml = '<i class="fas fa-file-pdf"></i>';
        else if (mime.includes('video')) iconHtml = '<i class="fas fa-video"></i>';
        else if (mime.includes('audio')) iconHtml = '<i class="fas fa-headphones"></i>';
        else if (mime.includes('image')) iconHtml = '<i class="fas fa-image"></i>';
        icon.innerHTML = iconHtml;

        const content = document.createElement('div');
        content.className = 'resource-content';

        const title = document.createElement('div');
        title.className = 'resource-title';
        title.textContent = file.filename || file.name || 'Untitled';

        const desc = document.createElement('div');
        desc.className = 'resource-desc';
        const typeText = file.category || file.type || (file.mimeType||'').split('/')[0] || '';
        const sizeText = formatSize(file.size);
        desc.textContent = (file.description || '') + (file.description ? ' â€¢ ' : '') + typeText + (sizeText?(' â€¢ ' + sizeText):'');

        const actions = document.createElement('div');
        actions.style.marginTop = '8px';

        // Primary action: open or download
        // Priority: external URL, then Firebase Storage path (on-demand), then base64 data
        if (file.url) {
          const fileName = file.filename || file.name || '';
          const isYouTube = file.url.includes('youtube.com') || file.url.includes('youtu.be');
          const isExternalPDF = /\.pdf$/i.test(file.url) || /\.pdf/i.test(fileName);
          const isExternalOffice = /\.(docx?|xlsx?|pptx?)$/i.test(file.url) || /\.(docx?|xlsx?|pptx?)/i.test(fileName);
          const isExternalText = /\.(txt|rtf|csv|json|xml|html?)$/i.test(file.url) || /\.(txt|rtf|csv|json|xml|html?)/i.test(fileName);
          const isExternalViewable = isYouTube || isExternalPDF || isExternalOffice || isExternalText;

          const openBtn = document.createElement('button');
          openBtn.className = 'resource-link';
          openBtn.innerHTML = `<i class="fas fa-eye"></i> View`;
          openBtn.addEventListener('click', () => {
            // Check if it's a YouTube URL and embed it
            if (isYouTube) {
              const videoId = getYouTubeVideoId(file.url);
              if (videoId) {
                const embedUrl = `https://www.youtube.com/embed/${videoId}`;
                openResourceModal(file.filename || file.name || 'YouTube Video', `<iframe src="${embedUrl}" allowfullscreen></iframe>`);
                return;
              }
            }
            // Check if it's a PDF and display inline
            if (isExternalPDF) {
              const viewerUrl = `https://docs.google.com/viewer?url=${encodeURIComponent(file.url)}&embedded=true`;
              const content = `
                <div style="width: 100%; height: 100%; position: relative;">
                  <iframe src="${viewerUrl}" style="width: 100%; height: 100%; border: none;" onload="this.style.opacity='1'" style="opacity: 0; transition: opacity 0.3s;"></iframe>
                  <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #666; font-size: 16px;">
                    <i class="fas fa-spinner fa-spin"></i> Loading document...
                  </div>
                </div>
              `;
              openResourceModal(fileName, content);
              // Fallback after 10 seconds if iframe doesn't load
              setTimeout(() => {
                const iframe = document.querySelector('#resourceViewerContent iframe');
                if (iframe && iframe.style.opacity !== '1') {
                  openResourceModal(fileName, `
                    <div style="text-align: center; padding: 40px;">
                      <i class="fas fa-exclamation-triangle" style="font-size: 48px; color: #f39c12; margin-bottom: 20px;"></i>
                      <h3 style="color: #333; margin-bottom: 15px;">Unable to preview this document</h3>
                      <p style="color: #666; margin-bottom: 20px;">The document viewer is unable to load this file. You can try opening it directly.</p>
                      <button onclick="closeResourceModal(); window.open('${file.url}', '_blank');" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-external-link-alt"></i> Open in New Tab
                      </button>
                    </div>
                  `);
                }
              }, 10000);
              return;
            }
            // Check if it's an Office document and use Google Docs viewer
            if (isExternalOffice) {
              const viewerUrl = `https://docs.google.com/viewer?url=${encodeURIComponent(file.url)}&embedded=true`;
              const content = `
                <div style="width: 100%; height: 100%; position: relative;">
                  <iframe src="${viewerUrl}" style="width: 100%; height: 100%; border: none;" onload="this.style.opacity='1'" style="opacity: 0; transition: opacity 0.3s;"></iframe>
                  <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #666; font-size: 16px;">
                    <i class="fas fa-spinner fa-spin"></i> Loading document...
                  </div>
                </div>
              `;
              openResourceModal(fileName, content);
              // Fallback after 10 seconds if iframe doesn't load
              setTimeout(() => {
                const iframe = document.querySelector('#resourceViewerContent iframe');
                if (iframe && iframe.style.opacity !== '1') {
                  openResourceModal(fileName, `
                    <div style="text-align: center; padding: 40px;">
                      <i class="fas fa-exclamation-triangle" style="font-size: 48px; color: #f39c12; margin-bottom: 20px;"></i>
                      <h3 style="color: #333; margin-bottom: 15px;">Unable to preview this document</h3>
                      <p style="color: #666; margin-bottom: 20px;">The document viewer is unable to load this file. You can try opening it directly.</p>
                      <button onclick="closeResourceModal(); window.open('${file.url}', '_blank');" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-external-link-alt"></i> Open in New Tab
                      </button>
                    </div>
                  `);
                }
              }, 10000);
              return;
            }
            // Check if it's a text file and display inline
            if (isExternalText) {
              fetch(file.url).then(response => response.text()).then(text => {
                openResourceModal(fileName, `<pre style="white-space: pre-wrap; font-family: monospace; padding: 20px; margin: 0; background: #f8f9fa; border-radius: 8px; max-height: 100%; overflow-y: auto;">${text}</pre>`);
              }).catch(err => {
                console.error('Failed to load external text file:', err);
                window.open(file.url, '_blank'); // Fallback
              });
              return;
            }
            // For other external URLs, open in new tab
            window.open(file.url, '_blank');
          });
          actions.appendChild(openBtn);
        } else if (file.storagePath || (file.storage && file.storage.path)) {
          // storagePath could be stored directly or under file.storage.path
          const path = file.storagePath || (file.storage && file.storage.path) || file.storage;
          const fileName = file.filename || file.name || '';
          const mimeType = file.mimeType || '';

          // Conservative viewable file detection - only files that reliably display inline
          const isDocument = /\.(odt|ods|odp)$/i.test(fileName) ||
                           /\b(document|spreadsheet|presentation)\b/i.test(mimeType);

          // Text files can be displayed as plain text
          const isTextFile = /\.(txt|rtf|csv|json|xml|html?)$/i.test(fileName) ||
                           mimeType.startsWith('text/') ||
                           mimeType === 'application/json' || mimeType === 'application/xml';

          // Office documents can be viewed using Google Docs viewer
          const isOfficeDoc = /\.(docx?|xlsx?|pptx?)$/i.test(fileName) ||
                            /\b(docx?|word|excel|powerpoint)\b/i.test(mimeType) ||
                            mimeType.startsWith('application/vnd.') || mimeType.startsWith('application/msword');

          const isVideo = (mimeType.startsWith('video/') ||
                          /\.(mp4|webm|ogg|avi|mov|wmv|flv|m4v)$/i.test(fileName)) &&
                          !isDocument && !isOfficeDoc && !isTextFile;

          const isImage = (mimeType.startsWith('image/') ||
                          /\.(jpg|jpeg|png|gif|bmp|webp|svg)$/i.test(fileName)) &&
                          !mimeType.includes('svg') || mimeType === 'image/svg+xml';

          // PDFs can be viewed inline in browsers
          const isPDF = (mimeType === 'application/pdf' ||
                        /\.pdf$/i.test(fileName)) &&
                        !isDocument && !isOfficeDoc && !isTextFile;
          const isViewable = (isVideo || isImage || isPDF || isTextFile) && !isDocument;
          // Office documents are viewable but open in new tab due to URL access limitations
          const isViewableInModal = (isVideo || isImage || isPDF || isTextFile) && !isDocument && !isOfficeDoc;

          // Final safeguard: explicitly exclude only truly non-viewable files
          const finalIsViewable = isViewableInModal;

          // Debug logging
          console.log('File processing:', {
            fileName,
            mimeType,
            isDocument,
            isTextFile,
            isOfficeDoc,
            isVideo,
            isImage,
            isPDF,
            isViewable,
            isViewableInModal,
            finalIsViewable
          });

          const openBtn = document.createElement('button');
          openBtn.className = 'resource-link';
          openBtn.innerHTML = `<i class="fas fa-eye"></i> View`;
          openBtn.addEventListener('click', (ev) => {
            openBtn.disabled = true; openBtn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> Loading...`;
            getStorageUrl(path).then(url => {
              if (isVideo) {
                openResourceModal(fileName, `<video controls><source src="${url}" type="${mimeType || 'video/mp4'}">Your browser does not support the video tag.</video>`);
              } else if (isImage) {
                openResourceModal(fileName, `<img src="${url}" alt="${fileName}" style="max-width: 100%; max-height: 100%; object-fit: contain;" />`);
              } else if (isOfficeDoc) {
                console.log('Opening Office document:', fileName, 'with URL:', url);
                // Download Office document as blob and open locally
                fetch(url).then(response => response.blob()).then(blob => {
                  const objectUrl = URL.createObjectURL(blob);
                  const a = document.createElement('a');
                  a.href = objectUrl;
                  a.target = '_blank';
                  a.rel = 'noopener noreferrer';
                  document.body.appendChild(a);
                  a.click();
                  document.body.removeChild(a);
                  // Clean up the object URL after a delay
                  setTimeout(() => URL.revokeObjectURL(objectUrl), 1000);
                  openBtn.disabled = false; openBtn.innerHTML = `<i class="fas fa-eye"></i> View`;
                }).catch(err => {
                  console.error('Failed to download Office document:', err);
                  // Fallback: try to open directly (will download)
                  window.open(url, '_blank');
                  openBtn.disabled = false; openBtn.innerHTML = `<i class="fas fa-eye"></i> View`;
                });
              } else if (isPDF) {
                // Use Google Docs viewer for PDFs as well
                const viewerUrl = `https://docs.google.com/viewer?url=${encodeURIComponent(url)}&embedded=true`;
                const content = `
                  <div style="width: 100%; height: 100%; position: relative;">
                    <iframe src="${viewerUrl}" style="width: 100%; height: 100%; border: none;" onload="this.style.opacity='1'" style="opacity: 0; transition: opacity 0.3s;"></iframe>
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #666; font-size: 16px;">
                      <i class="fas fa-spinner fa-spin"></i> Loading document...
                    </div>
                  </div>
                `;
                openResourceModal(fileName, content);
                // Fallback after 10 seconds if iframe doesn't load
                setTimeout(() => {
                  const iframe = document.querySelector('#resourceViewerContent iframe');
                  if (iframe && iframe.style.opacity !== '1') {
                    openResourceModal(fileName, `
                      <div style="text-align: center; padding: 40px;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 48px; color: #f39c12; margin-bottom: 20px;"></i>
                        <h3 style="color: #333; margin-bottom: 15px;">Unable to preview this document</h3>
                        <p style="color: #666; margin-bottom: 20px;">The document viewer is unable to load this file. You can try downloading it instead.</p>
                        <button onclick="closeResourceModal(); window.open('${url}', '_blank');" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
                          <i class="fas fa-external-link-alt"></i> Open in New Tab
                        </button>
                      </div>
                    `);
                  }
                }, 10000);
              } else if (isTextFile) {
                // Display text files inline in modal
                fetch(url).then(response => response.text()).then(text => {
                  openResourceModal(fileName, `<pre style="white-space: pre-wrap; font-family: monospace; padding: 20px; margin: 0; background: #f8f9fa; border-radius: 8px; max-height: 100%; overflow-y: auto;">${text}</pre>`);
                }).catch(err => {
                  console.error('Failed to load text file:', err);
                  window.open(url, '_blank'); // Fallback to opening in new tab
                });
              } else {
                // For truly non-viewable files, open directly in new tab
                window.open(url, '_blank');
                openBtn.disabled = false; openBtn.innerHTML = `<i class="fas fa-eye"></i> View`;
              }
            }).catch(err => {
              console.error('Storage URL failed', err);
              alert('Failed to load file.');
              openBtn.disabled = false; openBtn.innerHTML = `<i class="fas fa-eye"></i> View`;
            });
          });
          actions.appendChild(openBtn);
          const dlBtn = document.createElement('button');
          dlBtn.className = 'resource-link';
          dlBtn.style.marginLeft = '8px';
          dlBtn.innerHTML = '<i class="fas fa-download"></i> Download';
          dlBtn.addEventListener('click', () => {
            dlBtn.disabled = true; dlBtn.textContent = 'Preparing...';
            getStorageUrl(path).then(url => {
              // Use an anchor to download
              const a = document.createElement('a');
              a.href = url;
              a.target = '_blank';
              a.download = file.filename || file.name || '';
              document.body.appendChild(a);
              a.click();
              a.remove();
              dlBtn.disabled = false; dlBtn.innerHTML = '<i class="fas fa-download"></i> Download';
            }).catch(err => { console.error('Storage download failed', err); alert('Failed to download file.'); dlBtn.disabled = false; dlBtn.innerHTML = '<i class="fas fa-download"></i> Download'; });
          });
          actions.appendChild(dlBtn);
        } else if (file.data) {
          // Base64 payload: defer conversion until user clicks View
          const fileName = file.filename || file.name || 'File';
          const mimeType = file.mimeType || '';

          // Conservative viewable file detection for base64 data
          const isDocument = /\.(odt|ods|odp)$/i.test(fileName) ||
                           /\b(document|spreadsheet|presentation)\b/i.test(mimeType);

          // Text files can be displayed as plain text
          const isTextFile = /\.(txt|rtf|csv|json|xml|html?)$/i.test(fileName) ||
                           mimeType.startsWith('text/') ||
                           mimeType === 'application/json' || mimeType === 'application/xml';

          // Office documents can be viewed using Microsoft Office Online viewer
          const isOfficeDoc = /\.(docx?|xlsx?|pptx?)$/i.test(fileName) ||
                            /\b(docx?|word|excel|powerpoint)\b/i.test(mimeType) ||
                            mimeType.startsWith('application/vnd.') || mimeType.startsWith('application/msword');

          const isImage = mimeType.startsWith('image/') &&
                         /\.(jpg|jpeg|png|gif|bmp|webp)$/i.test(fileName) &&
                         (mimeType === 'image/svg+xml' || !mimeType.includes('svg'));

          // PDFs can be viewed inline in browsers
          const isPDF = mimeType === 'application/pdf' && /\.pdf$/i.test(fileName);
          const isViewable = (isImage || isOfficeDoc || isPDF || isTextFile) && !isDocument;

          // Final safeguard: explicitly exclude only truly non-viewable files
          const finalIsViewable = isViewable;

          const viewBtn = document.createElement('button');
          viewBtn.className = 'resource-link';
          viewBtn.innerHTML = `<i class="fas fa-eye"></i> View`;
          viewBtn.addEventListener('click', () => {
            viewBtn.disabled = true; viewBtn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> Loading...`;
            setTimeout(() => {
              const dataUrl = 'data:' + (mimeType || 'application/octet-stream') + ';base64,' + file.data;

              if (isImage) {
                openResourceModal(fileName, `<img src="${dataUrl}" alt="${fileName}" style="max-width: 100%; max-height: 100%; object-fit: contain;" />`);
              } else if (isPDF) {
                // Display PDF inline in modal
                openResourceModal(fileName, `<iframe src="${dataUrl}" style="width: 100%; height: 100%; border: none;"></iframe>`);
              } else if (isTextFile) {
                // Display text files inline in modal
                try {
                  const text = atob(file.data);
                  openResourceModal(fileName, `<pre style="white-space: pre-wrap; font-family: monospace; padding: 20px; margin: 0; background: #f8f9fa; border-radius: 8px; max-height: 100%; overflow-y: auto;">${text}</pre>`);
                } catch (err) {
                  console.error('Failed to decode base64 text:', err);
                  // Fallback to opening in new window
                  const w = window.open('about:blank');
                  if (!w) { alert('Popup blocked â€” allow popups to open files.'); viewBtn.disabled = false; viewBtn.innerHTML = `<i class="fas fa-eye"></i> View`; return; }
                  w.document.write('<iframe src="' + dataUrl + '" frameborder="0" style="width:100%;height:100%;"></iframe>');
                }
              } else if (isOfficeDoc) {
                // For base64 Office documents, open in new window since Google Docs viewer needs a URL
                const w = window.open('about:blank');
                if (!w) { alert('Popup blocked â€” allow popups to open files.'); viewBtn.disabled = false; viewBtn.innerHTML = `<i class="fas fa-eye"></i> View`; return; }
                w.document.write('<iframe src="' + dataUrl + '" frameborder="0" style="width:100%;height:100%;"></iframe>');
              } else {
                // For other base64 files, open in new window
                const w = window.open('about:blank');
                if (!w) { alert('Popup blocked â€” allow popups to open files.'); viewBtn.disabled = false; viewBtn.innerHTML = `<i class="fas fa-eye"></i> View`; return; }
                w.document.write('<iframe src="' + dataUrl + '" frameborder="0" style="width:100%;height:100%;"></iframe>');
              }
              viewBtn.disabled = false; viewBtn.innerHTML = `<i class="fas fa-eye"></i> View`;
            }, 50);
          });
          actions.appendChild(viewBtn);
          const dlBtn = document.createElement('button');
          dlBtn.className = 'resource-link';
          dlBtn.innerHTML = '<i class="fas fa-download"></i> Download';
          dlBtn.addEventListener('click', () => {
            dlBtn.disabled = true; dlBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Preparing...';
            setTimeout(() => {
              downloadBase64(file.filename || file.name || 'file', file.mimeType || 'application/octet-stream', file.data);
              dlBtn.disabled = false; dlBtn.innerHTML = '<i class="fas fa-download"></i> Download';
            }, 50);
          });
          actions.appendChild(dlBtn);
        } else {
          const noBtn = document.createElement('button');
          noBtn.className = 'resource-link';
          noBtn.textContent = 'Unavailable';
          noBtn.disabled = true;
          actions.appendChild(noBtn);
        }

        // Secondary: download original (if URL points to downloadable file), or show uploaded date
        const meta = document.createElement('div');
        meta.style.marginTop = '6px';
        meta.style.fontSize = '0.85rem';
        meta.style.color = '#555';
        if (file.uploadDate) {
          try { const d = new Date(file.uploadDate); meta.textContent = 'Uploaded: ' + d.toLocaleDateString(); } catch(e){}
        }

        content.appendChild(title);
        content.appendChild(desc);
        content.appendChild(actions);
        content.appendChild(meta);

        item.appendChild(icon);
        item.appendChild(content);
        return item;
      }

      function clearChildren(el){ while(el && el.firstChild) el.removeChild(el.firstChild); }

  // Initial data will be fetched in background (no visible loader)

      // helper to render snapshot
      function renderSnapshot(snap){
        const val = snap && snap.val ? snap.val() : null;
        const arr = val ? Object.keys(val).map(k => ({ key: k, ...(val[k]||{}) })) : [];
        const featured = [];
        const forms = [];
        const others = [];

        arr.forEach(f => {
          const cat = (f.category || f.type || '').toString().toLowerCase();
          const fname = (f.filename || f.name || '').toString().toLowerCase();
          if (f.featured || cat.includes('featured') || fname.includes('featured')) featured.push(f);
          else if (cat.includes('form') || fname.includes('form') || cat.includes('document') || cat.includes('consent')) forms.push(f);
          else others.push(f);
        });

        // Render
        if (featuredList) { clearChildren(featuredList); if (featured.length===0) { const p=document.createElement('div'); p.className='text-muted'; p.textContent='No featured resources.'; featuredList.appendChild(p);} else { featured.forEach(f=> featuredList.appendChild(createResourceNode(f))); } }
        if (formsList) { clearChildren(formsList); if (forms.length===0) { const p=document.createElement('div'); p.className='text-muted'; p.textContent='No forms available.'; formsList.appendChild(p);} else { forms.forEach(f=> formsList.appendChild(createResourceNode(f))); } }
        if (otherList) { clearChildren(otherList); if (others.length===0) { const p=document.createElement('div'); p.className='text-muted'; p.textContent='No other resources.'; otherList.appendChild(p);} else { others.forEach(f=> otherList.appendChild(createResourceNode(f))); } }
      }

      // Fetch initial snapshot (once) and then attach live listener
      filesRef.once('value').then(snap => {
        renderSnapshot(snap);
        // attach live updates
        filesRef.on('value', function(snap2){ renderSnapshot(snap2); }, function(err){ console.error('Files DB live error', err); });
      }).catch(err => {
        console.error('Files DB initial fetch error', err);
        // still attach listener so live updates continue
        filesRef.on('value', function(snap2){ renderSnapshot(snap2); }, function(err){ console.error('Files DB live error', err); });
      });

    })();
  </script>

  <!-- Resource Viewer Modal -->
  <div id="resourceViewerModal" class="modal-overlay hidden">
    <div class="modal-content resource-modal">
      <div class="modal-header">
        <h3 id="resourceModalTitle">Resource Viewer</h3>
        <button class="modal-close" onclick="closeResourceModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div id="resourceViewerContent"></div>
      </div>
    </div>
  </div>

  <script>
    function openResourceModal(title, content) {
      document.getElementById('resourceModalTitle').textContent = title;
      document.getElementById('resourceViewerContent').innerHTML = content;
      document.getElementById('resourceViewerModal').classList.remove('hidden');
    }

    function closeResourceModal() {
      document.getElementById('resourceViewerModal').classList.add('hidden');
      document.getElementById('resourceViewerContent').innerHTML = '';
    }

    // Close modal when clicking outside
    document.getElementById('resourceViewerModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeResourceModal();
      }
    });

    // Close modal on Escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && !document.getElementById('resourceViewerModal').classList.contains('hidden')) {
        closeResourceModal();
      }
    });
  </script>
</body>

</html>
